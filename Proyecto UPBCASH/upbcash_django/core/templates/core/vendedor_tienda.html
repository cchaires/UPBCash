{% extends 'core/layouts/vendor_shell.html' %}

{% block title %}UPBCash - Mi tienda{% endblock %}

{% block content %}
<header class="main__header">
  <div class="title-block">
    <h1 class="page-title">Mi tienda</h1>
    {% if event %}<p class="page-subtitle">Configura datos de tienda e imagen durante la campana.</p>{% else %}<p class="page-subtitle">No hay campana activa.</p>{% endif %}
  </div>
  <div class="status-pill">{% if event %}{{ event.name }}{% else %}Sin evento activo{% endif %}</div>
</header>

{% include 'core/includes/flash_messages.html' %}

<section class="panel mb-16">
  <div class="panel__title"><h2>{% if stall %}Editar tienda{% else %}Crear tienda{% endif %}</h2></div>
  {% if event %}
  <form method="post" enctype="multipart/form-data" class="form form--wide">
    {% csrf_token %}
    <div class="field">
      <label for="name">Nombre de tienda</label>
      <input class="input" id="name" name="name" type="text" maxlength="120" required value="{% if stall %}{{ stall.name }}{% endif %}" />
    </div>
    <div class="field">
      <label for="code">Codigo corto</label>
      <input class="input" id="code" name="code" type="text" maxlength="32" value="{% if stall %}{{ stall.code }}{% endif %}" />
    </div>
    <div class="field">
      <label for="description">Descripcion</label>
      <textarea class="input" id="description" name="description" rows="3">{% if stall %}{{ stall.description }}{% endif %}</textarea>
    </div>
    <div class="field">
      <label for="image">Imagen de tienda</label>
      <input class="input" id="image" name="image" type="file" accept="image/*" />
      {% if stall and stall.image %}
      <div class="mt-8"><img src="{{ stall.image.url }}" alt="Imagen de tienda" class="max-w-260 rounded-8" /></div>
      <label class="inline-check"><input type="checkbox" name="remove_image" /> Quitar imagen actual</label>
      {% endif %}
    </div>
    <div class="actions-row">
      <button class="btn btn--primary" type="submit">{% if stall %}Guardar cambios{% else %}Crear tienda{% endif %}</button>
    </div>
  </form>
  {% else %}
  <p class="item__desc">No puedes editar tienda porque no hay una campana activa.</p>
  {% endif %}
</section>

<section class="panel">
  <div class="panel__title"><h2>Visibilidad para clientes</h2></div>
  {% if stall %}
    {% if stall_location %}
    <p class="item__desc">Visible en mapa/menu cliente: <strong>SI</strong>. Espacio {{ stall_location.spot.label }}.</p>
    {% else %}
    <p class="item__desc">No visible en cliente hasta que staff asigne un espacio en mapa.</p>
    {% endif %}
    <p class="item__desc">Vendedores asignados: {{ stall_members|length }} / 3.</p>
  {% else %}
  <p class="item__desc">Todavia no tienes tienda para este evento.</p>
  {% endif %}
</section>
{% endblock %}
