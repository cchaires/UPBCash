{% extends 'core/layouts/client_shell.html' %}

{% block title %}UPBCash - Carrito de compras{% endblock %}

{% block content %}
<header class="main__header">
  <div>
    <h1 class="page-title">Carrito de compras</h1>
    <p class="page-subtitle">Productos agregados desde el menu V2.</p>
  </div>
</header>

{% if auto_pay_hint %}
<p class="flash flash--warning">Producto agregado. Revisa tu carrito y confirma el pago.</p>
{% endif %}
{% include 'core/includes/flash_messages.html' %}

<section class="card">
  <div class="list" id="cartList">
    {% for row in cart_rows %}
      <div class="list-item">
        <div>
          <div class="list-item__title">{{ row.name }}</div>
          <div class="list-item__meta">Puesto: {{ row.stall_name }} · Cantidad: {{ row.quantity }} · Unitario: ${{ row.unit_price|floatformat:2 }}</div>
        </div>
        <div class="list-item__price">
          ${{ row.line_total|floatformat:2 }}
          <form method="post" action="{% url 'carrito_cliente' %}">
            {% csrf_token %}
            <input type="hidden" name="action" value="remove" />
            <input type="hidden" name="stall_product_id" value="{{ row.stall_product_id }}" />
            <button class="btn btn--danger btn--mini btn-remove-item" type="submit">Eliminar</button>
          </form>
        </div>
      </div>
    {% empty %}
      <div class="list-item">
        <div>
          <div class="list-item__title">Tu carrito esta vacio</div>
          <div class="list-item__meta">Agrega productos desde el menu.</div>
        </div>
      </div>
    {% endfor %}
  </div>

  <div class="list-item mt-12">
    <div>
      <div class="list-item__title">Creditos disponibles</div>
      <div class="list-item__meta" id="creditsNote">Saldo para compras.</div>
    </div>
    <div class="list-item__price" id="creditsValue">${{ saldo_actual|floatformat:2 }}</div>
  </div>

  <div class="summary-row mt-16">
    <span>Total</span>
    <span id="totalValue">${{ cart_total|floatformat:2 }}</span>
  </div>

  <div class="actions-row mt-16">
    <a class="btn btn--secondary" href="{% url 'menu_alimentos' %}">Seguir comprando</a>

    <form method="post" action="{% url 'carrito_cliente' %}">
      {% csrf_token %}
      <input type="hidden" name="action" value="clear" />
      <button class="btn btn--ghost" type="submit">Limpiar carrito</button>
    </form>

    <form method="post" action="{% url 'carrito_cliente' %}">
      {% csrf_token %}
      <input type="hidden" name="action" value="pay" />
      <button class="btn btn--primary" type="submit">Pagar</button>
    </form>
  </div>
</section>
{% endblock %}
