{% extends 'core/layouts/vendor_shell.html' %}

{% block title %}UPBCash - Vendedor{% endblock %}

{% block content %}
<header class="main__header">
  <div class="title-block">
    <h1 class="page-title">Panel del vendedor</h1>
    {% if event %}
    <p class="page-subtitle">Resumen de hoy y control de productos para {{ event.name }}.</p>
    {% else %}
    <p class="page-subtitle">No hay un evento activo configurado.</p>
    {% endif %}
  </div>
  <div class="status-pill">{% if assignment %}Tienda: {{ assignment.stall.name }}{% else %}Sin tienda creada{% endif %}</div>
</header>

{% if assignment %}
<section class="panel mb-16">
  <div class="panel__title"><h2>Imagen de tienda</h2></div>
  {% if stall_image_url %}
  <img src="{{ stall_image_url }}" alt="Imagen de {{ assignment.stall.name }}" class="max-w-260 rounded-10" />
  {% else %}
  <p class="item__desc">Aun no has cargado una imagen de tienda. Puedes hacerlo en la seccion Productos.</p>
  {% endif %}
</section>
{% endif %}

{% if not assignment %}
<section class="panel mb-16">
  <p class="item__desc">Crea tu tienda para empezar a gestionar productos durante la campana.</p>
  <a class="btn btn--secondary" href="{% url 'vendedor_tienda' %}">Crear tienda</a>
</section>
{% endif %}

<section class="panel">
  <div class="panel__title">
    <h2>Resumen de hoy</h2>
    <span class="status-pill">{% now "d M Y" %}</span>
  </div>
  <div class="menu-grid">
    <article class="menu-item">
      <div class="item__name">Ventas del dia</div>
      <div class="item__desc">Total acumulado</div>
      <div class="item__price"><span>${{ today_sales_total|floatformat:2 }}</span></div>
    </article>
    <article class="menu-item">
      <div class="item__name">Pedidos pendientes</div>
      <div class="item__desc">Por atender</div>
      <div class="item__price"><span>{{ pending_orders }}</span></div>
    </article>
    <article class="menu-item">
      <div class="item__name">Stock bajo</div>
      <div class="item__desc">Productos por revisar</div>
      <div class="item__price"><span>{{ low_stock_count }}</span></div>
    </article>
  </div>
</section>

<section class="panel mt-16">
  <div class="panel__title">
    <h2>Ultimas ventas</h2>
    <a href="{% url 'vendedor_ventas' %}">Ver todas</a>
  </div>
  <div class="menu-grid">
    {% for row in latest_sales %}
    <article class="menu-item">
      <div class="item__name">{{ row.title }}</div>
      <div class="item__desc">{{ row.description }}</div>
      <div class="item__price"><span>${{ row.total|floatformat:2 }}</span></div>
    </article>
    {% empty %}
    <article class="menu-item">
      <div class="item__name">Sin ventas registradas</div>
      <div class="item__desc">Cuando haya compras en el esquema nuevo apareceran aqui.</div>
      <div class="item__price"><span>$0.00</span></div>
    </article>
    {% endfor %}
  </div>
</section>
{% endblock %}
