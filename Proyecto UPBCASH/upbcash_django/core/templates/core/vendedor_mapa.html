{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UPBCash - Mapa Vendedor</title>
  <link rel="stylesheet" href="{% static 'core/css/styles_vendedor_layout.css' %}" />
</head>
<body>
  <div class="page">
    <div class="app-shell">
      <aside class="sidebar">
        <div class="brand">
          <img class="brand__logo" src="{% static 'core/img/imgupbcash-logo-c.png' %}" alt="UPBCash" />
        </div>

        <nav class="nav" aria-label="Secciones del vendedor">
          <a class="nav__item" href="{% url 'vendedor' %}">
            <span class="nav__icon">ğŸ </span><span>Inicio</span>
          </a>
          <a class="nav__item" href="{% url 'vendedor_tienda' %}">
            <span class="nav__icon">ğŸª</span><span>Tienda</span>
          </a>
          <a class="nav__item" href="{% url 'vendedor_productos' %}">
            <span class="nav__icon">ğŸ½ï¸</span><span>Productos</span>
          </a>
          <a class="nav__item" href="{% url 'vendedor_ventas' %}">
            <span class="nav__icon">ğŸ“Š</span><span>Ventas</span>
          </a>
          <a class="nav__item nav__item--active" href="{% url 'vendedor_mapa' %}">
            <span class="nav__icon">ğŸ—ºï¸</span><span>Mapa</span>
          </a>
        </nav>

        <div class="sidebar__spacer"></div>

        <div class="userbox">
          <div class="userbox__avatar">ğŸ‘¤</div>
          <div class="userbox__info">
            <div class="userbox__name">{{ user_display_name }}</div>
            <div class="userbox__sub">Vendedor</div>
          </div>
          <button class="userbox__toggle" id="userToggle" aria-haspopup="true" aria-expanded="false" aria-label="Abrir menu de cuenta">â–¾</button>
          <div class="userbox__menu" id="userMenu" role="menu" aria-hidden="true">
            <a href="{% url 'cliente' %}" role="menuitem">Cliente</a>
            {% if can_view_vendor %}
            <a href="{% url 'vendedor' %}" role="menuitem">Vendedor</a>
            {% endif %}
            {% if can_view_staff %}
            <a href="{% url 'staff_panel' %}" role="menuitem">Staff</a>
            {% endif %}
            <a href="{% url 'logout' %}" role="menuitem">Cerrar sesion</a>
          </div>
        </div>
      </aside>

      <main class="main">
        <div class="main__inner main__inner--scroll">
          <section class="panel panel--croquis">
            <div class="panel__title">
              <h2>Croquis del estacionamiento</h2>
              <span class="status-pill">Espacios del evento</span>
            </div>

            <div class="croquis-wrap">
              <div class="assign-card">
                <h3>Asignacion</h3>
                {% if assignment %}
                <p>{{ assignment.stall.name }}</p>
                {% if assignment.spot %}
                <div class="badge-slot">Espacio {{ assignment.spot.label }}</div>
                <p>Zona: {{ assignment.spot.zone.name }}</p>
                {% else %}
                <div class="badge-slot">Sin espacio asignado</div>
                <p>Staff debe asignar tu tienda en el mapa.</p>
                {% endif %}
                {% else %}
                <p>No cuentas con una tienda activa.</p>
                <div class="badge-slot">Sin espacio</div>
                <p>Crea una tienda y luego solicita asignacion al staff.</p>
                {% endif %}
              </div>

              <div class="map-card">
                <div class="map-canvas" aria-label="Mapa del evento para vendedores">
                  <img class="map-canvas__image" src="{{ map_image_url }}" alt="Mapa del evento" />
                  {% for spot in map_spots %}
                  <div
                    class="map-spot-marker{% if spot.is_assigned %} map-spot-marker--assigned{% endif %}{% if spot.status == 'blocked' %} map-spot-marker--blocked{% endif %}{% if spot.is_vendor_spot %} map-spot-marker--vendor{% endif %}"
                    style="left: {{ spot.x_percent }}%; top: {{ spot.y_percent }}%;"
                    title="{{ spot.label }}{% if spot.stall_name %} Â· {{ spot.stall_name }}{% endif %}"
                  >
                    <span>{{ spot.label }}</span>
                  </div>
                  {% endfor %}
                </div>
                {% if not map_spots %}
                <p class="item__desc" style="margin-top: 10px;">Aun no hay espacios configurados para este evento.</p>
                {% endif %}

                <div class="legend">
                  <span><i class="vendor"></i>Tu espacio</span>
                  <span><i class="assigned"></i>Asignado</span>
                  <span><i></i>Disponible</span>
                  <span><i class="blocked"></i>Bloqueado</span>
                </div>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>
  </div>

  <script src="{% static 'core/js/dropdown_cliente.js' %}"></script>
</body>
</html>
