{% extends 'core/layouts/vendor_shell.html' %}

{% block title %}UPBCash - Mapa vendedor{% endblock %}

{% block content %}
<section class="panel panel--croquis">
  <div class="panel__title">
    <h2>Croquis del estacionamiento</h2>
    <span class="status-pill">Espacios del evento</span>
  </div>

  <div class="croquis-wrap">
    <div class="assign-card">
      <h3>Asignacion</h3>
      {% if assignment %}
      <p>{{ assignment.stall.name }}</p>
      {% if assignment.spot %}
      <div class="badge-slot">Espacio {{ assignment.spot.label }}</div>
      <p>Zona: {{ assignment.spot.zone.name }}</p>
      {% else %}
      <div class="badge-slot">Sin espacio asignado</div>
      <p>Staff debe asignar tu tienda en el mapa.</p>
      {% endif %}
      {% else %}
      <p>No cuentas con una tienda activa.</p>
      <div class="badge-slot">Sin espacio</div>
      <p>Crea una tienda y luego solicita asignacion al staff.</p>
      {% endif %}
    </div>

    <div class="map-card">
      <div class="map-canvas" aria-label="Mapa del evento para vendedores">
        <img class="map-canvas__image" src="{{ map_image_url }}" alt="Mapa del evento" />
        {% for spot in map_spots %}
        <div class="map-spot-marker js-vendor-map-spot{% if spot.is_assigned %} map-spot-marker--assigned{% endif %}{% if spot.status == 'blocked' %} map-spot-marker--blocked{% endif %}{% if spot.is_vendor_spot %} map-spot-marker--vendor{% endif %}" data-x="{{ spot.x_percent }}" data-y="{{ spot.y_percent }}" title="{{ spot.label }}{% if spot.stall_name %} Â· {{ spot.stall_name }}{% endif %}">
          <span>{{ spot.label }}</span>
        </div>
        {% endfor %}
      </div>
      {% if not map_spots %}
      <p class="item__desc mt-10">Aun no hay espacios configurados para este evento.</p>
      {% endif %}

      <div class="legend mt-10">
        <span><i class="vendor"></i>Tu espacio</span>
        <span><i class="assigned"></i>Asignado</span>
        <span><i></i>Disponible</span>
        <span><i class="blocked"></i>Bloqueado</span>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
  document.querySelectorAll(".js-vendor-map-spot").forEach((spot) => {
    spot.style.left = `${spot.dataset.x}%`;
    spot.style.top = `${spot.dataset.y}%`;
  });
</script>
{% endblock %}
