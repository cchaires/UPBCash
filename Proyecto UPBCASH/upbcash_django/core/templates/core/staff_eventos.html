{% extends 'core/layouts/staff_shell.html' %}

{% block title %}UPBCash - Eventos staff{% endblock %}

{% block content %}
<header class="main__header">
  <div>
    <h1 class="page-title">Gestion de campanas y eventos</h1>
    <p class="page-subtitle">Ventana de campana (staff/vendedor) y ventana publica (cliente).</p>
  </div>
</header>

{% include 'core/includes/flash_messages.html' %}

<section class="card mt-14">
  <h2 class="page-title staff-section-title">{% if editing_event %}Editar evento{% else %}Crear evento{% endif %}</h2>
  <form method="post" enctype="multipart/form-data" class="form form--wide staff-form-grid">
    {% csrf_token %}
    {% if editing_event %}<input type="hidden" name="event_id" value="{{ editing_event.id }}" />{% endif %}
    <div class="field"><label for="code">Codigo</label><input class="input" id="code" name="code" maxlength="32" required value="{% if editing_event %}{{ editing_event.code }}{% endif %}" /></div>
    <div class="field"><label for="name">Nombre</label><input class="input" id="name" name="name" maxlength="160" required value="{% if editing_event %}{{ editing_event.name }}{% endif %}" /></div>
    <div class="field">
      <label for="status">Status</label>
      <select class="input" id="status" name="status">
        {% for value, label in campaign_statuses %}
        <option value="{{ value }}" {% if editing_event and editing_event.status == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="field"><label for="starts_at">Campana inicia</label><input class="input" id="starts_at" name="starts_at" type="datetime-local" required value="{% if editing_event %}{{ editing_event.starts_at|date:'Y-m-d\\TH:i' }}{% endif %}" /></div>
    <div class="field"><label for="ends_at">Campana termina</label><input class="input" id="ends_at" name="ends_at" type="datetime-local" required value="{% if editing_event %}{{ editing_event.ends_at|date:'Y-m-d\\TH:i' }}{% endif %}" /></div>
    <div class="field"><label for="public_starts_at">Evento publico inicia</label><input class="input" id="public_starts_at" name="public_starts_at" type="datetime-local" value="{% if editing_event and editing_event.public_starts_at %}{{ editing_event.public_starts_at|date:'Y-m-d\\TH:i' }}{% endif %}" /></div>
    <div class="field"><label for="public_ends_at">Evento publico termina</label><input class="input" id="public_ends_at" name="public_ends_at" type="datetime-local" value="{% if editing_event and editing_event.public_ends_at %}{{ editing_event.public_ends_at|date:'Y-m-d\\TH:i' }}{% endif %}" /></div>
    <div class="field"><label for="max_map_spots">Maximo de espacios</label><input class="input" id="max_map_spots" name="max_map_spots" type="number" min="1" required value="{% if editing_event %}{{ editing_event.max_map_spots }}{% else %}5{% endif %}" /></div>
    <div class="field">
      <label for="map_image">Imagen del mapa</label>
      <input class="input" id="map_image" name="map_image" type="file" accept="image/*" />
      {% if editing_event and editing_event.map_image %}
      <img src="{{ editing_event.map_image.url }}" alt="Mapa" class="mt-8 max-w-280 rounded-8" />
      <label class="inline-check"><input type="checkbox" name="remove_map_image" /> Quitar imagen actual</label>
      {% endif %}
    </div>
    <div class="field grid-col-full"><label for="description">Descripcion</label><textarea class="input" id="description" name="description" rows="3">{% if editing_event %}{{ editing_event.description }}{% endif %}</textarea></div>
    <div class="actions-row grid-col-full">
      <button class="btn btn--secondary" type="submit">Guardar evento</button>
      <a class="btn btn--ghost" href="{% url 'staff_eventos' %}">Nuevo</a>
    </div>
  </form>
</section>

<section class="card mt-14">
  <h2 class="page-title staff-section-title">Eventos registrados</h2>
  <div class="list">
    {% for campaign in campaigns %}
    <article class="list-item">
      <div>
        <div class="list-item__title">{{ campaign.code }} Â· {{ campaign.name }}</div>
        <div class="list-item__meta">Campana: {{ campaign.starts_at|date:"d/m H:i" }} - {{ campaign.ends_at|date:"d/m H:i" }}</div>
        <div class="list-item__meta">Publico: {{ campaign.public_starts_at|default:campaign.starts_at|date:"d/m H:i" }} - {{ campaign.public_ends_at|default:campaign.ends_at|date:"d/m H:i" }}</div>
      </div>
      <a class="btn btn--secondary" href="{% url 'staff_eventos' %}?event_id={{ campaign.id }}">Editar</a>
    </article>
    {% empty %}
    <article class="list-item"><div class="list-item__title">Sin eventos registrados.</div></article>
    {% endfor %}
  </div>
</section>
{% endblock %}
